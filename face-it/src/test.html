<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      const detail = 3;
      const scale = 5;
      const grid = new Map();

      const getKey = (x, y) => `${x}|${y}`;

      const updateGrid = (row, col, x, y) => {
        const key = getKey(row, col);
        if (!grid.has(key)) {
          grid.set(key, [x + col * scale, y + row * scale]);
        }
      };

      function getNeighboursByDimension(x, y, dim = 1, _scale = 1) {
        for (let col = -dim; col <= dim; col++) {
          for (let row = -dim; row <= dim; row++) {
            if (!(col === 0 && row === 0)) {
              const _x = (x + col) * _scale;
              const _y = (y + row) * _scale;

              const key = getKey(_x, _y);
              if (!grid.has(key)) {
                grid.set(key, [_x, _y]);
              }
            }
          }
        }
      }

      console.time("x");
      for (let i in [...Array(100)]) {
        const mesh = [
          [839, 739, -8],
          [842, 684, -22],
          [840, 697, -10],
          [827, 623, -19],
          [842, 667, -24],
          [842, 642, -24],
          [840, 579, -15],
          [720, 565, 0],
          [839, 544, -15],
          [839, 522, -18],
          [836, 417, -17],
          [839, 748, -8],
          [839, 754, -6],
          [839, 756, -4],
          [839, 765, -2],
          [839, 774, -2],
          [839, 784, -2],
          [839, 794, -1],
          [839, 809, 4],
          [842, 692, -20],
          [826, 688, -13],
          [647, 491, 15],
          [769, 581, -2],
          [753, 582, -2],
          [736, 582, -1],
          [714, 572, 1],
          [783, 576, -2],
          [743, 546, -6],
          [761, 546, -6],
          [728, 548, -5],
          [718, 552, -3],
          [699, 584, 3],
          [778, 833, 10],
          [713, 561, 1],
          [643, 569, 22],
          [678, 572, 7],
          [758, 660, -2],
          [820, 737, -8],
          [823, 754, -5],
          [800, 742, -6],
          [789, 749, -2],
          [810, 755, -4],
          [799, 756, -1],
          [768, 775, 5],
          [828, 684, -22],
          [826, 667, -24],
          [689, 538, -4],
          [789, 613, -6],
          [788, 673, -11],
          [787, 663, -10],
          [709, 657, 1],
          [827, 644, -22],
          [731, 528, -12],
          [706, 530, -9],
          [664, 463, 5],
          [806, 543, -14],
          [777, 549, -4],
          [756, 758, 5],
          [664, 731, 43],
          [800, 683, -9],
          [814, 688, -9],
          [775, 760, 4],
          [783, 759, 3],
          [695, 518, -7],
          [788, 680, -8],
          [764, 531, -14],
          [760, 516, -16],
          [735, 427, -12],
          [680, 489, -2],
          [750, 469, -14],
          [677, 528, -1],
          [662, 510, 6],
          [821, 747, -7],
          [806, 750, -5],
          [794, 753, -2],
          [805, 685, -8],
          [780, 760, 4],
          [786, 764, 2],
          [785, 757, 3],
          [809, 680, -16],
          [802, 754, 0],
          [813, 755, -2],
          [825, 755, -3],
          [818, 808, 4],
          [820, 793, -1],
          [821, 782, -2],
          [822, 772, -2],
          [824, 765, -2],
          [800, 761, 0],
          [797, 764, 0],
          [793, 770, 0],
          [790, 776, 1],
          [774, 727, -2],
          [643, 641, 45],
          [841, 693, -13],
          [793, 760, 2],
          [790, 762, 2],
          [820, 697, -9],
          [794, 690, -4],
          [817, 693, -9],
          [773, 623, -4],
          [747, 636, -2],
          [784, 670, -7],
          [692, 441, -4],
          [709, 474, -9],
          [724, 512, -12],
          [781, 788, 5],
          [800, 521, -18],
          [791, 467, -17],
          [782, 419, -16],
          [722, 578, 0],
          [681, 596, 6],
          [791, 572, -2],
          [698, 555, 0],
          [801, 603, -8],
          [798, 669, -16],
          [662, 607, 11],
          [694, 610, 3],
          [717, 618, 0],
          [749, 615, -1],
          [772, 607, -2],
          [788, 599, -4],
          [824, 583, -14],
          [668, 646, 12],
          [682, 552, 1],
          [833, 691, -19],
          [791, 633, -6],
          [636, 562, 36],
          [801, 590, -5],
          [782, 669, -3],
          [708, 563, 2],
          [797, 657, -15],
          [650, 685, 45],
          [790, 566, -1],
          [811, 648, -19],
          [704, 785, 23],
          [703, 801, 32],
          [648, 645, 28],
          [684, 757, 27],
          [652, 536, 15],
          [773, 851, 14],
          [834, 693, -13],
          [777, 645, -4],
          [662, 574, 11],
          [738, 571, -1],
          [753, 572, -2],
          [781, 767, 3],
          [673, 681, 16],
          [803, 877, 17],
          [751, 847, 23],
          [728, 828, 27],
          [838, 467, -18],
          [840, 880, 16],
          [766, 571, -2],
          [779, 568, -2],
          [787, 567, -1],
          [668, 547, 5],
          [775, 553, -3],
          [760, 548, -4],
          [745, 548, -4],
          [730, 551, -3],
          [722, 556, -1],
          [639, 522, 27],
          [728, 568, 0],
          [840, 710, -8],
          [787, 716, -4],
          [800, 681, -11],
          [818, 712, -8],
          [839, 559, -13],
          [726, 811, 20],
          [748, 831, 17],
          [803, 866, 10],
          [683, 771, 38],
          [785, 561, -2],
          [813, 612, -13],
          [840, 869, 10],
          [775, 865, 19],
          [655, 684, 30],
          [811, 763, 0],
          [808, 768, -1],
          [805, 776, -1],
          [803, 786, 0],
          [797, 799, 4],
          [790, 757, 1],
          [785, 756, 1],
          [780, 754, 0],
          [763, 742, 1],
          [697, 694, 8],
          [812, 592, -10],
          [803, 559, -4],
          [792, 559, -3],
          [793, 754, 1],
          [694, 735, 17],
          [818, 561, -10],
          [787, 815, 7],
          [841, 620, -21],
          [825, 604, -17],
          [841, 600, -18],
          [801, 639, -12],
          [840, 851, 7],
          [840, 828, 6],
          [813, 826, 6],
          [749, 781, 8],
          [770, 684, -1],
          [766, 800, 8],
          [733, 681, 0],
          [756, 702, 0],
          [720, 710, 4],
          [807, 848, 7],
          [791, 648, -8],
          [733, 793, 14],
          [755, 814, 13],
          [737, 759, 7],
          [677, 711, 19],
          [715, 758, 12],
          [665, 721, 30],
          [744, 727, 2],
          [802, 622, -9],
          [804, 677, -17],
          [793, 679, -11],
          [811, 668, -20],
          [791, 549, -7],
          [763, 542, -9],
          [740, 541, -9],
          [720, 542, -7],
          [706, 546, -4],
          [695, 567, 3],
          [643, 606, 25],
          [710, 592, 2],
          [728, 598, 0],
          [750, 597, -1],
          [771, 593, -2],
          [786, 587, -2],
          [797, 582, -3],
          [639, 601, 42],
          [794, 683, -9],
          [813, 630, -16],
          [816, 680, -20],
          [825, 687, -18],
          [816, 682, -18],
          [799, 688, -7],
          [828, 689, -19],
          [829, 691, -13],
          [796, 568, -1],
          [805, 574, -4],
          [810, 578, -7],
          [717, 559, 0],
          [709, 556, 0],
          [855, 622, -19],
          [954, 559, 2],
          [856, 687, -13],
          [1012, 483, 19],
          [905, 577, -1],
          [921, 578, 0],
          [937, 577, 0],
          [959, 565, 3],
          [892, 574, -1],
          [930, 541, -4],
          [912, 542, -4],
          [946, 542, -2],
          [956, 545, 0],
          [971, 577, 6],
          [901, 829, 11],
          [960, 554, 4],
          [1017, 560, 25],
          [990, 564, 10],
          [918, 656, -1],
          [858, 736, -8],
          [854, 753, -5],
          [876, 740, -5],
          [887, 746, -1],
          [866, 753, -3],
          [876, 754, 0],
          [907, 772, 7],
          [856, 683, -22],
          [858, 666, -24],
          [983, 530, -1],
          [887, 611, -5],
          [891, 671, -10],
          [892, 660, -9],
          [963, 651, 3],
          [857, 643, -22],
          [944, 522, -10],
          [967, 523, -6],
          [998, 456, 9],
          [872, 541, -14],
          [897, 546, -3],
          [918, 754, 7],
          [996, 722, 47],
          [879, 681, -8],
          [866, 687, -9],
          [898, 758, 6],
          [890, 756, 5],
          [977, 510, -5],
          [891, 677, -8],
          [913, 527, -13],
          [916, 512, -14],
          [934, 423, -10],
          [987, 482, 0],
          [924, 465, -13],
          [992, 520, 2],
          [1002, 502, 10],
          [856, 746, -7],
          [871, 748, -4],
          [881, 751, -1],
          [875, 684, -7],
          [894, 757, 5],
          [889, 762, 3],
          [889, 755, 4],
          [872, 678, -15],
          [872, 753, 0],
          [863, 754, -1],
          [851, 755, -3],
          [860, 807, 5],
          [858, 792, 0],
          [857, 781, -2],
          [855, 771, -2],
          [853, 764, -1],
          [875, 760, 1],
          [878, 762, 1],
          [882, 767, 0],
          [886, 773, 2],
          [902, 724, -1],
          [1013, 632, 49],
          [881, 758, 3],
          [885, 760, 3],
          [860, 696, -8],
          [885, 688, -4],
          [863, 692, -9],
          [902, 620, -2],
          [928, 632, 0],
          [894, 667, -6],
          [974, 436, -1],
          [962, 468, -6],
          [950, 506, -10],
          [895, 784, 6],
          [878, 518, -17],
          [884, 465, -17],
          [890, 418, -16],
          [951, 573, 2],
          [988, 589, 9],
          [885, 570, -1],
          [974, 547, 2],
          [876, 601, -7],
          [883, 667, -15],
          [1004, 599, 15],
          [977, 604, 6],
          [956, 613, 2],
          [925, 611, 0],
          [903, 604, -1],
          [887, 597, -3],
          [856, 583, -13],
          [999, 637, 16],
          [988, 544, 4],
          [850, 691, -19],
          [886, 631, -5],
          [1019, 553, 40],
          [875, 589, -4],
          [894, 667, -2],
          [964, 556, 4],
          [883, 655, -14],
          [1008, 675, 49],
          [886, 563, 0],
          [870, 647, -19],
          [966, 777, 25],
          [965, 792, 34],
          [1014, 635, 32],
          [983, 748, 30],
          [1010, 528, 19],
          [905, 847, 15],
          [848, 692, -13],
          [899, 642, -3],
          [1003, 565, 14],
          [937, 566, 0],
          [922, 568, 0],
          [893, 764, 4],
          [995, 673, 19],
          [876, 874, 17],
          [924, 842, 24],
          [944, 821, 29],
          [909, 567, -1],
          [896, 565, 0],
          [889, 564, 0],
          [999, 539, 8],
          [900, 550, -2],
          [914, 544, -2],
          [929, 543, -2],
          [943, 545, -1],
          [952, 549, 0],
          [1018, 514, 31],
          [947, 563, 1],
          [890, 714, -3],
          [880, 679, -10],
          [861, 711, -7],
          [947, 803, 22],
          [927, 825, 19],
          [877, 863, 11],
          [981, 761, 41],
          [890, 558, -1],
          [867, 611, -13],
          [902, 861, 20],
          [1007, 674, 34],
          [865, 762, 0],
          [868, 767, 0],
          [871, 774, 0],
          [874, 784, 0],
          [880, 797, 5],
          [884, 755, 2],
          [889, 754, 2],
          [894, 751, 2],
          [912, 738, 2],
          [973, 687, 10],
          [866, 591, -10],
          [873, 557, -4],
          [883, 557, -2],
          [880, 752, 2],
          [975, 727, 20],
          [860, 560, -10],
          [891, 812, 8],
          [856, 603, -17],
          [878, 638, -11],
          [866, 824, 7],
          [925, 776, 10],
          [907, 680, 0],
          [910, 796, 10],
          [941, 676, 1],
          [920, 698, 1],
          [953, 704, 6],
          [873, 845, 8],
          [886, 646, -7],
          [941, 786, 16],
          [921, 809, 14],
          [937, 753, 9],
          [990, 702, 22],
          [957, 751, 14],
          [999, 712, 34],
          [930, 722, 4],
          [876, 620, -9],
          [877, 675, -16],
          [887, 677, -11],
          [871, 666, -20],
          [885, 546, -6],
          [912, 538, -7],
          [935, 535, -7],
          [954, 535, -5],
          [967, 539, -1],
          [976, 560, 6],
          [1018, 597, 29],
          [962, 586, 4],
          [945, 593, 1],
          [923, 593, 0],
          [903, 589, 0],
          [889, 584, -1],
          [878, 580, -2],
          [1016, 592, 46],
          [885, 681, -8],
          [867, 629, -15],
          [867, 679, -20],
          [857, 686, -17],
          [866, 680, -17],
          [880, 686, -7],
          [855, 689, -19],
          [853, 690, -13],
          [880, 566, 0],
          [870, 572, -3],
          [866, 577, -6],
          [957, 552, 2],
          [964, 549, 1],
        ];

        grid.clear;
        for (const [x, y] of mesh) {
          getNeighboursByDimension(x, y, detail, scale);
        }
      }
      console.timeEnd("x");
    </script>
  </body>
</html>
